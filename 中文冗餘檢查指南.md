# 🔍 冗餘檢查系統 (Redundancy Check System)

這個系統為 Cortex 專案提供全面的冗餘檢測和清理功能，處理向量、關係、進程和代碼中的重複項目。

## 快速開始

### 1. 完整冗餘檢查
```bash
npm run 冗餘檢查
# 或使用英文名稱
npm run redundancy:check
```

### 2. 分類檢查
```bash
# 向量冗餘檢查
npm run 向量冗餘檢查
npm run redundancy:check:vector

# 關係冗餘檢查  
npm run 關係冗餘檢查
npm run redundancy:check:relationship

# 進程冗餘檢查
npm run 進程冗餘檢查
npm run redundancy:check:process

# 代碼冗餘檢查
npm run 代碼冗餘檢查  
npm run redundancy:check:code
```

### 3. 清理操作
```bash
# 清理向量冗餘
npm run 清理向量冗餘
npm run redundancy:cleanup:vector

# 清理關係冗餘
npm run 清理關係冗餘  
npm run redundancy:cleanup:relationship

# 進階清理
npm run redundancy:validate
npm run redundancy:cleanup-duplicates
```

## 使用範例

### 生成綜合報告
```bash
npm run 冗餘檢查 -- --output=reports/冗餘檢查報告.md
```

### 清理特定類型
```bash
# 檢查並清理向量冗餘
npm run 清理向量冗餘 -- --output=reports/清理報告.md
```

### 定期監控腳本
```bash
# 每日檢查和報告
0 2 * * * cd /路徑/到/cortexyoung && npm run 冗餘檢查 -- --output=reports/每日-$(date +%Y%m%d).md

# 每週清理執行
0 3 * * 0 npm run 清理向量冗餘 && npm run 清理關係冗餘
```

## 檢測內容

### 1. 向量冗餘 (Vector Redundancy)
- ✅ 重複的嵌入向量
- ✅ 重複的向量內容  
- ✅ 空間計算 (float32 字節)

### 2. 關係冗餘 (Relationship Redundancy)
- ✅ 重複的關係 (來源→目標→類型→元數據)
- ✅ 過時的關係
- ✅ 循環引用

### 3. 進程冗餘 (Process Redundancy)
- ✅ 多個運行中的嵌入進程
- ✅ 重複的工作進程
- ✅ 內存浪費估算

### 4. 代碼冗餘 (Code Redundancy)
- ✅ 重複的函數實現
- ✅ 重複的配置
- ✅ 代碼重複檢測

## 預期輸出範例

```
🔍 Cortex 冗餘檢查器
============================

# 向量冗餘報告
- 總項目數: 1582
- 重複項目: 47  
- 浪費空間: 1.8MB

# 關係冗餘報告
- 總項目數: 892
- 重複項目: 12
- 浪費空間: 12KB

✅ 向量冗餘清理完成: 已移除 47 個重複向量
```

## 配置選項
- 自動向量維度計算 (實際嵌入大小)
- 基於哈希的去重 (SHA256 for 向量, MD5 for 關係)
- 安全清理 (保留首次出現, 移除重複)
- 空間估算和報告
- 進度日誌

## 文件結構

```
src/
├── redundancy-checker.ts           # 主要檢查器類別
├── cli/
│   └── redundancy-check.ts         # 命令行界面
└── validation/
    ├── relationship-redundancy.ts  # 關係專用驗證
    └── cleanup-duplicates.ts       # 清理腳本

reports/
├── redundancy-{timestamp}.md      # 詳細報告
└── cleanup-{timestamp}.md       # 清理報告
```

## 故障排除

### 權限問題
```bash
sudo chown -R $(whoami) ./reports/
chmod -R 755 ./reports/
```

### 大數據集內存問題
```bash
node --max-old-space-size=4096 ./node_modules/.bin/ts-node -r ts-node/register src/cli/redundancy-check.ts
```

### 舊鎖清理
```bash  
rm -rf ./tmp/redundancy-*
```

## 中文命令總覽

| 中文命令 | 英文對應 | 功能說明 |
|----------|----------|----------|
| `npm run 冗餘檢查` | `redundancy:check` | 完整冗餘檢查 |
| `npm run 向量冗餘檢查` | `redundancy:check:vector` | 向量冗餘檢查 |
| `npm run 關係冗餘檢查` | `redundancy:check:relationship` | 關係冗餘檢查 |
| `npm run 進程冗餘檢查` | `redundancy:check:process` | 進程冗餘檢查 |
| `npm run 代碼冗餘檢查` | `redundancy:check:code` | 代碼冗餘檢查 |
| `npm run 清理向量冗餘` | `redundancy:cleanup:vector` | 清理向量冗餘 |
| `npm run 清理關係冗餘` | `redundancy:cleanup:relationship` | 清理關係冗餘 |